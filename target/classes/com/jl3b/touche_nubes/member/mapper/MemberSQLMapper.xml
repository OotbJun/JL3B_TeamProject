<?xml version="1.0" encoding="UTF-8"?>

<!-- 복붙 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jl3b.touche_nubes.member.mapper.MemberSQLMapper">
	
	
	<!-- 입주민 -->
	<!-- 입주민 가입 -->
	<insert id="insertResi">
		<![CDATA[
			INSERT INTO JL3B_RESI VALUES(
				JL3B_RESI_SEQ.NEXTVAL,
				#{npki_key},
				#{resi_id},
				#{resi_pw},
				#{resi_rname},
				#{resi_mail},
				1,
				0,
				SYSDATE)
		]]>
	</insert>
	
	<!-- 입주민 로그인 -->
	<select id="selectResiByIdAndPw" resultType="com.jl3b.touche_nubes.membervo.ResiVo">
		<![CDATA[
			SELECT * 
			FROM 
			JL3B_RESI 
			WHERE 
			resi_id = #{resi_id} 
			AND 
			resi_pw = #{resi_pw}
		]]>
	</select>
	
	<!-- 입주민 확인 -->
	<select id="selectResiByNo" resultType="com.jl3b.touche_nubes.membervo.ResiVo">
		<![CDATA[
			SELECT * 
			FROM 
				JL3B_RESI 
			WHERE 
				resi_no = #{no}
		]]>
	</select>
	
	<!-- 아이디 확인 -->
	<select id="selectResiById" resultType="com.jl3b.touche_nubes.membervo.ResiVo">
		<![CDATA[
			SELECT * 
			FROM 
				JL3B_RESI 
			WHERE 
				resi_id = #{id}
		]]>
	</select>
	
	<!-- 입주민 인증번호 중복방지 -->
	<select id="selectResiByNpki" resultType="com.jl3b.touche_nubes.membervo.ResiVo">
		<![CDATA[
			SELECT * 
			FROM 
				JL3B_RESI 
			WHERE NPKI_KEY = #{key}
		]]>	
	</select>
	
	<!-- 인증번호 유효성검사? -->
   <select id="existNpki" resultType="String">
      <![CDATA[
         SELECT * 
         FROM 
            JL3B_NPKI 
         WHERE NPKI_KEY = #{key}
      ]]>   
   </select>
   
   <!-- 아이디 찾기 -->
   <select id="searchResiId" resultType="String">
 		<![CDATA[
 			SELECT NVL(resi_id,0) 
 			FROM JL3B_RESI 
 			WHERE 
 				NPKI_KEY = #{npki_key} 
 			AND 
 				RESI_RNAME = #{resi_rname}
 		]]>  
   </select>
   
   <!-- 비밀번호 변경 조건 -->
   <select id="conditionResiPw" resultType="com.jl3b.touche_nubes.membervo.ResiVo">
   		<![CDATA[
   			SELECT * 
   			FROM 
   				JL3B_RESI 
   			WHERE 
   				RESI_ID = #{resi_id} 
   			AND 
   				RESI_MAIL = #{resi_mail}
   		]]>
   </select>
	
   <!-- 입주민 회원 비밀번호 변경 -->
   <update id="updateResiPw">
   		<![CDATA[
   			UPDATE JL3B_RESI 
   			SET 
   				RESI_PW = #{resi_pw} 
   			WHERE 
   				RESI_NO = #{resi_no}
   		]]>
   </update>
   
   <!-- 인증 키 -->
   <select id="creatKey" resultType="int">
         <![CDATA[
	      	SELECT JL3B_RESI_SEQ.nextval FROM DUAL
	     ]]>
   </select>
   
	
	<!-- 센터 -->
	<!-- 센터 가입 -->
	<insert id="insertCenter">
		<![CDATA[
			INSERT INTO JL3B_CENTER VALUES(
				#{center_no},
				#{npki_key},
				#{center_id},
				#{center_pw},
				#{center_name},
				#{center_mail},
				#{center_pr},
				#{center_about},
				SYSDATE)
		]]>
	</insert>
   
   <!-- 센터 인증번호 중복방지 -->
   <select id="selectCenterByNpki" resultType="com.jl3b.touche_nubes.membervo.CenterVo">
   		<![CDATA[
   			SELECT *
   			FROM
   				JL3B_CENTER
   			WHERE NPKI_KEY = #{key}
   		]]>
   </select>
   
   <!-- 센터 보기 -->
	<select id="selectCenterByNo" resultType="com.jl3b.touche_nubes.membervo.CenterVo">
		<![CDATA[
			SELECT * 
			FROM 
				JL3B_CENTER
			WHERE 
				center_no = #{center_no}
		]]>
	</select>
	
	<!-- 센터 로그인 -->
	<select id="selectCenterByIdAndPw" resultType="com.jl3b.touche_nubes.membervo.CenterVo">
		<![CDATA[
			SELECT * 
			FROM 
				JL3B_CENTER 
			WHERE 
				center_id = #{center_id} 
			AND 
				center_pw = #{center_pw}
		]]>
	</select>
	
	<!-- 이메일 중복확인 -->
   <select id="existEmail" resultType="String">
      <![CDATA[
         SELECT * 
         FROM 
         	JL3B_RESI 
         WHERE 
         	resi_mail = #{resi_mail}
      ]]>
   </select>
   
   <!-- 센터 아이디 중복체크 -->
   <select id="selectCenterById" resultType="String">
      <![CDATA[
         SELECT * 
         FROM 
            JL3B_CENTER
         WHERE 
            center_id = #{center_id}
      ]]>
   </select>
   
   <!-- 센터 이메일 중복확인 -->
   <select id="existCenterEmail" resultType="String">
      <![CDATA[
         SELECT * 
         FROM 
            JL3B_CENTER
         WHERE 
            center_mail = #{center_mail}
      ]]>
   </select>
   
   <!-- 센터 아이디 찾기 -->
   <select id="searchCenterId" resultType="String">
 		<![CDATA[
 			SELECT NVL(center_id, 0) 
 			FROM 
 				JL3B_CENTER 
 			WHERE 
 				NPKI_KEY = #{npki_key} 
 			AND 
 				CENTER_NAME = #{center_name}
 		]]>  
   </select>
   
   <!-- 센터 비밀번호 변경 조건 -->
   <select id="conditionCenterPw" resultType="com.jl3b.touche_nubes.membervo.CenterVo">
   		<![CDATA[
   			SELECT * 
   			FROM 
   				JL3B_CENTER 
   			WHERE 
   				CENTER_ID = #{center_id} 
   			AND 
   				CENTER_MAIL = #{center_mail}
   		]]>
   </select>
   
   <!-- 센터 비밀번호 변경 -->
   <update id="updateCenterPw">
   		<![CDATA[
   			UPDATE JL3B_CENTER 
   			SET 
   				CENTER_PW = #{center_pw} 
   			WHERE 
   				CENTER_NO = #{center_no}
   		]]>
   </update>
   
   
   <!-- 관리자 -->
   <!-- 전체 회원 목록 출력 -->
   <select id="selectResiAll" resultType="com.jl3b.touche_nubes.membervo.ResiVo">
   		<![CDATA[
   			SELECT * FROM JL3B_RESI ORDER BY RESI_GRADE DESC
   		]]>
   </select>
   
   <update id="updateResiGrade">
   		<![CDATA[
   			UPDATE JL3B_RESI SET RESI_GRADE = #{resi_grade} WHERE RESI_NO = #{resi_no}
   		]]>
   </update>

</mapper>