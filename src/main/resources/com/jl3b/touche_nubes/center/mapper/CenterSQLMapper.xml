<?xml version="1.0" encoding="UTF-8"?>

<!-- 복붙 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.jl3b.touche_nubes.center.mapper.CenterSQLMapper">
	
	
	<!-- 센터정보 -->
	<!-- 파일업로드용 키 -->
	<select id="createCenterKey" resultType="int">
		<![CDATA[
			SELECT JL3B_center_seq.NEXTVAL FROM DUAL
		]]>
	</select>
	
	<!-- 센터 정보 등록 
	<insert id="insertCenterInfo">
		<![CDATA[
			INSERT INTO JL3B_CENTER_INFO 
			VALUES(
				#{info_no}, 
				#{center_no}, 
				#{info_pr},
				#{info_about}
			)
		]]>
	</insert>
	-->
	
	<!-- 센터 정보 수정 
	<update id="updateCenterInfo">
		<![CDATA[
			UPDATE JL3B_CENTER_INFO 
			SET 
				INFO_PR = #{info_pr} 
			WHERE CENTER_NO = #{center_no}
		]]>
	</update>
	-->
	
	<!-- 센터 정보 삭제 
	<delete id="deleteCenterInfo">
		<![CDATA[
			DELETE FROM JL3B_CENTER_INFO 
			WHERE INFO_NO = #{info_no}
		]]>
	</delete>
	-->
	
	<!-- 센터 정보 보기 -->
	<select id="selectCenterInfoByNo" resultType="com.jl3b.touche_nubes.membervo.CenterVo">
		<![CDATA[
			SELECT * 
			FROM 
				JL3B_CENTER
			WHERE CENTER_NO = #{center_no}
		]]>
	</select>
	
	<!-- 센터 리스트 -->
	<select id="selectCenterInfoAll" resultType="com.jl3b.touche_nubes.membervo.CenterVo">
		<![CDATA[
			SELECT * FROM JL3B_CENTER ORDER BY center_no DESC
		]]>
	</select>
	
	
	<!-- 센터리뷰 -->
	<!-- 센터 리뷰 등록 -->
	<insert id="insertCenterReview">
		<![CDATA[
			INSERT INTO JL3B_CENTER_REVIEW 
			VALUES(
				JL3B_CENTER_REVIEW_SEQ.NEXTVAL, 
				#{center_no},
				#{member_no},
				#{review_comment}, 
				SYSDATE
			)
		]]>
	</insert>
	
	<!-- 센터 리뷰 수정 -->
	<update id="updateCenterReview">
		<![CDATA[
			UPDATE JL3B_CENTER_REVIEW 
			SET 
				REVIEW_COMMENT = #{review_comment}, REVIEW_WDATE = SYSDATE 
			WHERE REVIEW_NO = #{review_no}
		]]>
	</update>
	
	<!-- 센터 리뷰 삭제 -->
	<delete id="deleteCenterReview">
		<![CDATA[
			DELETE FROM JL3B_CENTER_REVIEW WHERE REVIEW_NO = #{review_no}
		]]>
	</delete>
	
	<!-- 센터 리뷰 보기 -->
	<select id="selectCenterReviewByNo" resultType="com.jl3b.touche_nubes.centervo.CenterReviewVo">
		<![CDATA[
			SELECT * FROM JL3B_CENTER_REVIEW WHERE REVIEW_NO = #{review_no}
		]]>
	</select>
	
	<!-- 리뷰 전체보기 -->
	<select id="selectCenterReviewAll" resultType="com.jl3b.touche_nubes.centervo.CenterReviewVo">
		<![CDATA[
			SELECT * FROM JL3B_CENTER_REVIEW WHERE CENTER_NO = #{center_no}
		]]>
	</select>
	
	
	<!-- 예약 -->
	<!-- 강의 예약하기 -->
	<insert id="insertReserve">
		<![CDATA[
			INSERT INTO JL3B_Reserve VALUES(JL3B_Reserve_SEQ.NEXTVAL, #{member_no}, #{lesson_no})
		]]>
	</insert>
	
	<!-- 강의 예약 취소 -->
	<delete id="deleteReserve">
		<![CDATA[
			DELETE FROM JL3B_Reserve 
			WHERE lesson_no=#{lesson_no} 
    		AND member_no=#{member_no}
		]]>
	</delete>
	
	<!-- 예약내역 확인 -->
	<select id="readlesson" resultType="com.jl3b.touche_nubes.centervo.ReserveVo">
		<![CDATA[
			 SELECT * FROM JL3B_Reserve 
   			 WHERE member_no=#{member_no}
		]]>
	</select>
	
	<!-- 예약자 확인 -->
	<select id="readmember" resultType="com.jl3b.touche_nubes.centervo.ReserveVo">
		<![CDATA[
			SELECT * FROM JL3B_Reserve 
   		 	WHERE lesson_no=#{lesson_no}
		]]>
	</select>
	
	
	<!-- 예약자 수 확인 -->
	<select id="coutbyReserve" resultType="int">
		<![CDATA[
			SELECT COUNT(reserve_no) as cnt	
			FROM Jl3B_Reserve 
			WHERE lesson_no=#{lesson_no}
		]]>
	</select>

	
	<!-- 예약 체크 -->
	<select id="checkReserve" resultType="com.jl3b.touche_nubes.centervo.ReserveVo">
	  	SELECT * FROM JL3B_Reserve 
	  	WHERE lesson_no=#{lesson_no} 
	  	AND member_no =#{member_no}
  	</select>
  	
  	
	<select id="createKey" resultType="int">
		SELECT JL3B_lessonInfo_seq.nextval FROM DUAL
	</select>
	
	<!-- 강의 -->
	<!-- 강의 등록 -->
	<insert id="insertlessonInfo">
		<![CDATA[
			INSERT INTO JL3B_lessonInfo 
			VALUES(
				#{info_no}, 
				#{center_no},
				#{info_title}, 
				#{info_content}
			)
		]]>
	</insert>
	
	<!-- 프로그램 수정 -->
	<update id="updateProg">
		<![CDATA[
			UPDATE JL3B_PROG 
			SET 
				PROG_TITLE = #{prog_title}, 
				PROG_CONTENT = #{prog_content} 
			WHERE 
				PROG_NO = #{prog_no}
		]]>
	</update>
	
	<!-- 프로그램 삭제 -->
	<delete id="deleteProg">
		<![CDATA[
			DELETE FROM JL3B_PROG WHERE PROG_NO = #{prog_no}
		]]>
	</delete>
	
	
	<!-- 강의 -->
	<!-- 시간대 등록 -->
	<insert id="insertlesson">
		<![CDATA[
			INSERT INTO JL3B_lesson
			VALUES(
				JL3B_lesson_SEQ.NEXTVAL, 
				#{info_no}, 
				#{lesson_date}, 
				#{lesson_time},
				#{lesson_people}, 
				'예약'
			)
		]]>
	</insert>
	
	<!-- 예약 인원 수 -->
	<update id="countbyReserve">
		<![CDATA[
			SELECT COUNT(reserve_no) as cnt
			FROM JL3B_reserve
			WHERE lesson_no=#{lesson_no}
		]]>
	</update>
	
	<select id = "selectList" resultType="com.jl3b.touche_nubes.centervo.LessonVo">
		<![CDATA[
			SELECT a.lesson_no, b.center_no, a.info_no, b.info_title, b.info_content, a.lesson_date, a.lesson_time, a.lesson_people, a.lesson_horsehead
			FROM JL3B_lesson a, JL3B_lessonInfo b 
			WHERE a.info_no=b.info_no 
			AND b.center_no = #{center_no}
		]]>
	</select>
	
	<!-- 입주민 확인 -->
	<select id="selectlessonInfoByNo" resultType="com.jl3b.touche_nubes.centervo.LessonInfoVo">
		<![CDATA[
			SELECT * 
			FROM 
				JL3B_lessonInfo
			WHERE 
				info_no = #{no}
		]]>
	</select>
	
	
	<!-- 예약 말머리 수정 -->
	<update id="updateHorsehead">
		<![CDATA[
			UPDATE JL3B_lesson L1 SET lesson_horsehead = '마감'
			WHERE (
			SELECT COUNT(reserve_no) as cnt
			FROM(SELECT L.lesson_no, L.info_no, L.lesson_people, L.lesson_horsehead, R.reserve_no
			FROM JL3B_lesson L, JL3B_reserve R WHERE L.lesson_no = R.lesson_NO) GROUP BY lesson_NO HAVING lesson_NO=L1.lesson_NO    
			) >= #{lesson_people}
		]]>
	</update>
	
</mapper>